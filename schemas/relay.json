{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "RelayRequest": {
      "type": "object",
      "required": ["id", "timestamp", "source", "target", "stream_type"],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "timestamp": {
          "type": "integer"
        },
        "source": {
          "$ref": "#/definitions/RelayEndpoint"
        },
        "target": {
          "$ref": "#/definitions/RelayEndpoint"
        },
        "stream_type": {
          "type": "string",
          "enum": ["video", "audio", "data", "control"]
        },
        "encryption": {
          "$ref": "#/definitions/EncryptionParams"
        },
        "bandwidth_limit": {
          "type": "integer",
          "description": "Max bandwidth in kbps"
        }
      }
    },
    "RelayEndpoint": {
      "type": "object",
      "required": ["device_id", "connection_type"],
      "properties": {
        "device_id": {
          "type": "string"
        },
        "connection_type": {
          "type": "string",
          "enum": ["direct", "nat", "relay", "mobile"]
        },
        "ice_candidates": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/IceCandidate"
          }
        },
        "public_ip": {
          "type": "string",
          "format": "ipv4"
        },
        "port": {
          "type": "integer"
        }
      }
    },
    "IceCandidate": {
      "type": "object",
      "required": ["candidate", "sdpMid", "sdpMLineIndex"],
      "properties": {
        "candidate": {
          "type": "string",
          "description": "ICE candidate string"
        },
        "sdpMid": {
          "type": "string"
        },
        "sdpMLineIndex": {
          "type": "integer"
        }
      }
    },
    "RelaySession": {
      "type": "object",
      "required": ["session_id", "created_at", "status"],
      "properties": {
        "session_id": {
          "type": "string",
          "format": "uuid"
        },
        "created_at": {
          "type": "integer"
        },
        "status": {
          "type": "string",
          "enum": ["connecting", "active", "paused", "terminated"]
        },
        "turn_server": {
          "$ref": "#/definitions/TurnServer"
        },
        "stun_servers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/StunServer"
          }
        },
        "metrics": {
          "$ref": "#/definitions/RelayMetrics"
        }
      }
    },
    "TurnServer": {
      "type": "object",
      "required": ["url", "username", "credential"],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "TURN server URL (turn:server:port)"
        },
        "username": {
          "type": "string"
        },
        "credential": {
          "type": "string",
          "description": "TURN credential (password or token)"
        },
        "credential_type": {
          "type": "string",
          "enum": ["password", "token"],
          "default": "password"
        }
      }
    },
    "StunServer": {
      "type": "object",
      "required": ["url"],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri",
          "description": "STUN server URL (stun:server:port)"
        }
      }
    },
    "RelayMetrics": {
      "type": "object",
      "properties": {
        "bytes_sent": {
          "type": "integer"
        },
        "bytes_received": {
          "type": "integer"
        },
        "packets_lost": {
          "type": "integer"
        },
        "latency_ms": {
          "type": "number"
        },
        "jitter_ms": {
          "type": "number"
        },
        "bandwidth_kbps": {
          "type": "number"
        }
      }
    },
    "EncryptionParams": {
      "type": "object",
      "required": ["enabled", "method"],
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "method": {
          "type": "string",
          "enum": ["dtls-srtp", "e2e-aes256", "none"]
        },
        "key_exchange": {
          "type": "string",
          "enum": ["ecdhe", "rsa", "pre-shared"]
        }
      }
    },
    "MobileStreamRequest": {
      "type": "object",
      "required": ["mobile_device_id", "source_device_id", "quality"],
      "properties": {
        "mobile_device_id": {
          "type": "string",
          "description": "iOS/Android device ID"
        },
        "source_device_id": {
          "type": "string",
          "description": "Lite/Pro device streaming HDMI"
        },
        "quality": {
          "type": "string",
          "enum": ["auto", "720p30", "1080p30", "adaptive"],
          "description": "Stream quality for mobile"
        },
        "network_type": {
          "type": "string",
          "enum": ["wifi", "4g", "5g", "unknown"]
        },
        "relay_required": {
          "type": "boolean",
          "description": "Force relay even if P2P possible"
        }
      }
    }
  }
}